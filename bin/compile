#!/bin/bash

BUILD_DIR=$1
CACHE_DIR=$2

IMAGEMAGICK_REPO="https://github.com/ImageMagick/ImageMagick.git"
INSTALL_DIR="$HOME/imagemagick"

# Install dependencies
echo "Installing dependencies..."
apt-get update
apt install build-essential libltdl-dev libjpeg-dev libpng-dev libtiff-dev libwebp-dev libgif-dev libheif-dev libfreetype6-dev liblcms2-dev libxml2-dev ghostscript

# Clone the ImageMagick repository and checkout the desired version
echo "Cloning ImageMagick repository..."
git clone ${IMAGEMAGICK_REPO} /tmp/imagemagick
cd /tmp/imagemagick

# Build ImageMagick
echo "Building ImageMagick..."
./configure --with-modules
./configure --with-heic=yes
identify -list format | grep HEIC
make
make install

# Clean up
cd /
rm -rf /tmp/imagemagick

# Update environment variables to include local installation directories
echo "Updating environment variables..."
echo "export PATH=${INSTALL_DIR}/bin:\$PATH" >> $BUILD_DIR/.profile
echo "export LD_LIBRARY_PATH=${INSTALL_DIR}/lib:\$LD_LIBRARY_PATH" >> $BUILD_DIR/.profile
echo "export MAGICK_HOME=${INSTALL_DIR}" >> $BUILD_DIR/.profile

ldconfig /usr/local/lib

magick --version

echo "ImageMagick ${IMAGEMAGICK_VERSION} installed successfully!"










#!/bin/bash

BUILD_DIR=$1
CACHE_DIR=$2

# Define the version to install
IMAGEMAGICK_VERSION="7.1.0-4"
IMAGEMAGICK_REPO="https://github.com/ImageMagick/ImageMagick.git"
INSTALL_DIR="$HOME/imagemagick"

# Install dependencies for ImageMagick and HEIC support
echo "Installing dependencies..."
apt-get update
apt-get install -y build-essential libjpeg-dev libpng-dev libtiff-dev \
                   libfreetype6-dev libx11-dev libheif-dev pkg-config \
                   libraw-dev

# Clone the ImageMagick repository and checkout the desired version
echo "Cloning ImageMagick repository..."
git clone ${IMAGEMAGICK_REPO} /tmp/imagemagick
cd /tmp/imagemagick
git checkout ${IMAGEMAGICK_VERSION}

# Build ImageMagick with HEIC support
echo "Building ImageMagick ${IMAGEMAGICK_VERSION} with HEIC support..."

# Configure ImageMagick to install locally
./configure --prefix=${INSTALL_DIR} --with-heic=yes
make
make install

# Clean up
cd /
rm -rf /tmp/imagemagick

# Update environment variables to include local installation directories
echo "Updating environment variables..."
echo "export PATH=${INSTALL_DIR}/bin:\$PATH" >> $BUILD_DIR/.profile
echo "export LD_LIBRARY_PATH=${INSTALL_DIR}/lib:\$LD_LIBRARY_PATH" >> $BUILD_DIR/.profile
echo "export MAGICK_HOME=${INSTALL_DIR}" >> $BUILD_DIR/.profile

echo "ImageMagick ${IMAGEMAGICK_VERSION} installed successfully with HEIC support in user directory!"
